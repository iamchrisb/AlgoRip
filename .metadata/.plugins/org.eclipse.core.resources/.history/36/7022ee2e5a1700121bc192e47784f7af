package algo.view;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.util.Random;

import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;

import algo.sort.HeapSort;
import algo.sort.InsertionSort;
import algo.sort.MergeSort;
import algo.sort.QuickSort;
import algo.sort.SelectionSort;
import algo.sort.Sort;
import algo.util.FileIntArray;

public class SortView extends JFrame {

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private Integer[] array_to_sort = new Integer[1000];
	private Integer[] res_array = new Integer[1000];

	private SelectionSort selectionsort = new SelectionSort();
	private InsertionSort insertsort = new InsertionSort();
	private MergeSort mergesort = new MergeSort();
	private HeapSort heapsort = new HeapSort();
	private QuickSort quicksort = new QuickSort();
	private Sort[] so = { selectionsort, insertsort, mergesort, heapsort,
			quicksort };

	private JTextArea sortedArrayTextArea;
	private JTextArea chosenArrayTextArea;
	private JComboBox sortBox;
	private JLabel time;
	private JComboBox arrayBox;
	
	private File mainFile = new File("D:/EclipseALGO/workspace/algo_ripphausen/res/");

	public SortView() {

		this.setLayout(new GridLayout(0, 2));

		JPanel left = new JPanel();
		left.setBounds(200, 200, this.getWidth() / 2, this.getHeight());

		JPanel right = new JPanel();
		right.setBounds(200 + this.getWidth() / 2, 200, this.getWidth() / 2,
				this.getHeight());
		right.setBackground(Color.lightGray);

		this.add(left);
		this.add(right);

		left.setLayout(new BorderLayout());
		right.setLayout(new BorderLayout());

		// fill with Sort-Array
		sortBox = new JComboBox(so);

		JLabel l = new JLabel("choose to sort:");
		JButton b = new JButton("sort!");
		JButton generate = new JButton("generate");
		JPanel northpa = new JPanel();

		northpa.add(l);
		northpa.add(sortBox);
		northpa.add(b);

		left.add(northpa, BorderLayout.NORTH);

		chosenArrayTextArea = new JTextArea(20, 20);
		left.add(new JScrollPane(chosenArrayTextArea), BorderLayout.CENTER);
		GridLayout g = new GridLayout(0, 2);
		JPanel pg = new JPanel(g);
		pg.add(generate);
		time = new JLabel("foobar");
		pg.add(time);
		left.add(pg, BorderLayout.SOUTH);

		JLabel res = new JLabel("Result: ");
		sortedArrayTextArea = new JTextArea(20, 20);

		arrayBox = new JComboBox(mainFile.listFiles());
		arrayBox.addActionListener(new ActionListener() {

			@Override
			public void actionPerformed(ActionEvent arg0) {
				File current = ((File) arrayBox.getSelectedItem());
				chosenArrayTextArea.setText("");
				sortedArrayTextArea.setText("");
				Integer[] p = FileIntArray.FileToIntegerArray(current.getAbsolutePath());
				for(int i = 0; i < p.length; i++){
					chosenArrayTextArea.setText(chosenArrayTextArea.getText() + p[i] + "\n");
				}
			}
		});
		right.add(res, BorderLayout.SOUTH);
		right.add(arrayBox, BorderLayout.NORTH);
		right.add(new JScrollPane(sortedArrayTextArea), BorderLayout.CENTER);

		this.setVisible(true);
		this.setBounds(0, 0, 800, 600);

		generate.addActionListener(new ActionListener() {

			@Override
			public void actionPerformed(ActionEvent arg0) {
				Thread tr2 = new Thread(runnableGenerate);
				tr2.start();
			}
		});

		b.addActionListener(new ActionListener() {
			@Override
			public void actionPerformed(ActionEvent arg0) {
				Thread tr1 = new Thread(runnableSort);
				tr1.start();
			}
		});
	}
	
	Runnable r3 = new Runnable() {
		@Override
		public void run() {
			chosenArrayTextArea.setText("");
			sortedArrayTextArea.setText("");
//			FileIntArray
		};
	};
	
	Runnable runnableGenerate = new Runnable() {
		@Override
		public void run() {
			chosenArrayTextArea.setText("");
			sortedArrayTextArea.setText("");
			Random rand = new Random();
			for (int i = 0; i < array_to_sort.length; i++) {
				int j = (rand.nextInt(10000));
				array_to_sort[i] = j;
				chosenArrayTextArea.setText(chosenArrayTextArea.getText() + j + "\n");
			}
		}
	};

	Runnable runnableSort = new Runnable() {
		@Override
		public void run() {
				sortedArrayTextArea.setText("");
				Long start = System.currentTimeMillis();
				res_array = ((Sort) sortBox.getSelectedItem()).sort(array_to_sort);
				start = System.currentTimeMillis() - start;
				time.setText(start.toString());
				System.out.println(start);
				for (int i = 0; i < res_array.length; i++) {
					sortedArrayTextArea.setText(sortedArrayTextArea.getText() + res_array[i] + "\n");
				}
		}
	};
}
